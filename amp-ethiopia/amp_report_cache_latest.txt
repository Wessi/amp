delete from amp_report_cache;


insert into amp_report_cache
select '',amp_activity.amp_activity_id,amp_id,amp_activity.name 'activity_name',amp_funding.amp_modality_id 
'amp_modality_id',amp_modality.name 'modality_name',
amp_activity.amp_status_id 'amp_status_id',amp_status.name 'status_name',
amp_terms_assist.terms_assist_name,amp_organisation.name 'donor_name',amp_organisation.amp_org_id 
'amp_donor_id',amp_organisation.org_type 'org_type',amp_funding.amp_funding_id,
case when transaction_type='0' and adjustment_type='0' and org_role_code='DN' then transaction_amount else 0 end 
'planned_commitment',
case when transaction_type='1' and adjustment_type='0' and org_role_code='DN' then transaction_amount else 0 end 
'planned_disbursement',
case when transaction_type='2' and adjustment_type='0' and org_role_code='DN' then transaction_amount else 0 end 
'planned_expenditure',
case when transaction_type='0' and adjustment_type='1' and org_role_code='DN' then transaction_amount else 0 end 
'actual_commitment',
case when transaction_type='1' and adjustment_type='1' and org_role_code='DN' then transaction_amount else 0 end 
'actual_disbursement',
case when transaction_type='2' and adjustment_type='1' and org_role_code='DN' then transaction_amount else 0 end 
'actual_expenditure',
currency_code,amp_activity.actual_start_date,amp_activity.actual_completion_date,amp_activity.proposed_start_date,
amp_activity.proposed_approval_date,extract(YEAR from transaction_date) 'fiscal_year',
case when extract(MONTH from transaction_date) between '1' and '3' then '1'
when extract(MONTH from transaction_date) between '4' and '6' then '2'
when extract(MONTH from transaction_date) between '7' and '9' then '3'
when extract(MONTH from transaction_date) between '10' and '12' then '4' end 'fiscal_quarter',org_role_code 
'perspective',amp_team_id,transaction_date 'transaction_date',amp_activity.amp_level_id,amp_level.name,amp_activity.description, 
NULL , NULL , NULL , NULL , 1 
from amp_activity,amp_currency,amp_modality,amp_terms_assist,amp_funding,amp_organisation,amp_status,amp_funding_detail,amp_level 
where amp_funding.amp_modality_id=amp_modality.amp_modality_id 
and amp_activity.amp_activity_id=amp_funding.amp_activity_id and amp_funding.amp_donor_org_id=amp_organisation.amp_org_id 
and amp_funding.amp_terms_assist_id=amp_terms_assist.amp_terms_assist_id 
and amp_activity.amp_status_id =amp_status.amp_status_id 
and amp_funding.amp_funding_id=amp_funding_detail.amp_funding_id 
and amp_funding_detail.amp_currency_id=amp_currency.amp_currency_id 
and amp_activity.amp_level_id=amp_level.amp_level_id and org_role_code='DN';


insert into amp_report_cache
select '',amp_activity.amp_activity_id,amp_id,amp_activity.name 'activity_name',amp_funding.amp_modality_id 
'amp_modality_id',amp_modality.name 'modality_name',
amp_activity.amp_status_id 'amp_status_id',amp_status.name 'status_name',
amp_terms_assist.terms_assist_name,amp_organisation.name 'donor_name',amp_organisation.amp_org_id 
'amp_donor_id',amp_organisation.org_type 'org_type',amp_funding.amp_funding_id,
case when transaction_type='0' and adjustment_type='0' and org_role_code='MA' then transaction_amount else 0 end 
'planned_commitment',
case when transaction_type='1' and adjustment_type='0' and org_role_code='MA' then transaction_amount else 0 end 
'planned_disbursement',
case when transaction_type='2' and adjustment_type='0' and org_role_code='MA' then transaction_amount else 0 end 
'planned_expenditure',
case when transaction_type='0' and adjustment_type='1' and org_role_code='MA' then transaction_amount else 0 end 
'actual_commitment',
case when transaction_type='1' and adjustment_type='1' and org_role_code='MA' then transaction_amount else 0 end 
'actual_disbursement',
case when transaction_type='2' and adjustment_type='1' and org_role_code='MA' then transaction_amount else 0 end 
'actual_expenditure',
currency_code,amp_activity.actual_start_date,amp_activity.actual_completion_date,amp_activity.proposed_start_date,
amp_activity.proposed_approval_date,extract(YEAR from transaction_date) 'fiscal_year',
case when extract(MONTH from transaction_date) between '1' and '3' then '1'
when extract(MONTH from transaction_date) between '4' and '6' then '2'
when extract(MONTH from transaction_date) between '7' and '9' then '3'
when extract(MONTH from transaction_date) between '10' and '12' then '4' end 'fiscal_quarter',org_role_code 
'perspective',amp_team_id ,transaction_date 'transaction_date',amp_activity.amp_level_id,amp_level.name,amp_activity.description, 
NULL , NULL , NULL , NULL , 1 
from amp_activity,amp_currency,amp_modality,amp_terms_assist,amp_funding,amp_organisation,amp_status,amp_funding_detail,amp_level 
where amp_funding.amp_modality_id=amp_modality.amp_modality_id 
and amp_activity.amp_activity_id=amp_funding.amp_activity_id and amp_funding.amp_donor_org_id=amp_organisation.amp_org_id 
and amp_funding.amp_terms_assist_id=amp_terms_assist.amp_terms_assist_id 
and amp_activity.amp_status_id =amp_status.amp_status_id
and amp_funding.amp_funding_id=amp_funding_detail.amp_funding_id 
and amp_funding_detail.amp_currency_id=amp_currency.amp_currency_id 
and amp_activity.amp_level_id=amp_level.amp_level_id and org_role_code='MA';


insert into amp_report_cache
select '',amp_activity.amp_activity_id,amp_activity.amp_id,amp_activity.name,NULL,NULL, 
amp_activity.amp_status_id,amp_status.name,NULL,amp_organisation.name,amp_org_role.organisation,amp_organisation.org_type,NULL,
0 'planned_commitment',0 'planned_disbursement',0 'planned_expenditure',
0 'actual_commitment',0 'actual_disbursement',0 'actual_expenditure',
NULL,amp_activity.actual_start_date,amp_activity.actual_completion_date,amp_activity.proposed_start_date,
amp_activity.proposed_approval_date,NULL 'fiscal_year',
NULL 'fiscal_quarter','MA',amp_activity.amp_team_id,NULL,amp_activity.amp_level_id,case when amp_activity.amp_level_id='1' then 'REGIONAL' 
when amp_activity.amp_level_id='2' then 'NATIONAL' 
when amp_activity.amp_level_id='3' then 'BOTH' else 'Unpecified' end 
'level_name',amp_activity.description, 
NULL , NULL , NULL , NULL , 1 
from amp_activity LEFT JOIN amp_report_cache ON 
amp_activity.amp_activity_id=amp_report_cache.amp_activity_id,amp_org_role,amp_organisation,amp_status
where amp_report_cache.amp_activity_id is null
and role='1'
and amp_activity.amp_activity_id=amp_org_role.activity
and amp_org_role.organisation=amp_organisation.amp_org_id
and amp_activity.amp_status_id=amp_status.amp_status_id;


insert into amp_report_cache
select '',amp_activity.amp_activity_id,amp_id,amp_activity.name,NULL,NULL, 
amp_activity.amp_status_id,amp_status.name,NULL,NULL,NULL,NULL,NULL,
0 'planned_commitment',0 'planned_disbursement',0 'planned_expenditure',
0 'actual_commitment',0 'actual_disbursement',0 'actual_expenditure',
NULL,amp_activity.actual_start_date,amp_activity.actual_completion_date,amp_activity.proposed_start_date,
amp_activity.proposed_approval_date,NULL 'fiscal_year',
NULL 'fiscal_quarter','MA',amp_team_id,NULL,amp_activity.amp_level_id,case when amp_activity.amp_level_id='1' then 'REGIONAL' 
when amp_activity.amp_level_id='2' then 'NATIONAL' 
when amp_activity.amp_level_id='3' then 'BOTH' else 'Not Exist' end 
'level_name',amp_activity.description, 
NULL , NULL , NULL , NULL , 1 
from amp_activity LEFT JOIN amp_funding ON 
amp_activity.amp_activity_id=amp_funding.amp_activity_id,amp_status
where amp_funding.amp_funding_id is null 
and amp_activity.amp_status_id=amp_status.amp_status_id;

insert into amp_report_cache
select '',amp_activity.amp_activity_id,amp_id,amp_activity.name,amp_funding.amp_modality_id,
case when amp_funding.amp_modality_id='1' then 'Direct Budget Support' 
when amp_funding.amp_modality_id='2' then 'Pool Fund' 
when amp_funding.amp_modality_id='3' then 'Project Support' 
when amp_funding.amp_modality_id='4' then 'Food Aid' 
when amp_funding.amp_modality_id='5' then 'Technical Assistance' 
when amp_funding.amp_modality_id='6' then 'Program Support' else 'Not Exist' end 'modality_name',
amp_activity.amp_status_id,amp_status.name,amp_terms_assist.terms_assist_name,amp_organisation.name
'donor_name',amp_organisation.amp_org_id
'amp_donor_id',amp_organisation.org_type
'org_type',amp_funding.amp_funding_id,
case when transaction_type='0' and adjustment_type='0' and 
org_role_code='DN' then transaction_amount else 0 end 'planned_commitment',
case when transaction_type='1' and adjustment_type='0' and 
org_role_code='DN' then transaction_amount else 0 end 'planned_disbursement',
case when transaction_type='2' and adjustment_type='0' and 
org_role_code='DN' then transaction_amount else 0 end 'planned_expenditure',
case when transaction_type='0' and adjustment_type='1' and 
org_role_code='DN' then transaction_amount else 0 end 'actual_commitment',
case when transaction_type='1' and adjustment_type='1' and 
org_role_code='DN' then transaction_amount else 0 end 'actual_disbursement',
case when transaction_type='2' and adjustment_type='1' and 
org_role_code='DN' then transaction_amount else 0 end 'actual_expenditure',
currency_code,amp_activity.actual_start_date,amp_activity.actual_completion_date,amp_activity.proposed_start_date,
amp_activity.proposed_approval_date,extract(YEAR from transaction_date) 'fiscal_year',
case when extract(MONTH from transaction_date) between '1' and '3' then '1' 
when extract(MONTH from transaction_date) between '4' and '6' then '2' 
when extract(MONTH from transaction_date) between '7' and '9' then '3' 
when extract(MONTH from transaction_date) between '10' and '12' then '4' 
end 'fiscal_quarter',org_role_code 'perspective',amp_team_id,transaction_date 
'transaction_date',amp_activity.amp_level_id,case when amp_activity.amp_level_id='1' then 'REGIONAL' 
when amp_activity.amp_level_id='2' then 'NATIONAL' 
when amp_activity.amp_level_id='3' then 'BOTH' else 'Not Exist' end 
'level_name',amp_activity.description, 
NULL , NULL , NULL , NULL , 1 
from amp_activity LEFT JOIN amp_funding ON 
amp_activity.amp_activity_id=amp_funding.amp_activity_id,amp_funding_detail, 
amp_terms_assist,amp_organisation, amp_currency,amp_level,amp_status
where (amp_funding.amp_modality_id is null or amp_activity.amp_level_id is null) 
and amp_funding.amp_funding_id=amp_funding_detail.amp_funding_id 
and amp_funding.amp_donor_org_id=amp_organisation.amp_org_id 
and amp_funding.amp_terms_assist_id=amp_terms_assist.amp_terms_assist_id 
and amp_funding_detail.amp_currency_id=amp_currency.amp_currency_id 
and amp_activity.amp_status_id=amp_status.amp_status_id
and org_role_code='DN';

insert into amp_report_cache
select '',amp_activity.amp_activity_id,amp_id,amp_activity.name,amp_funding.amp_modality_id,case 
when amp_funding.amp_modality_id='1' then 'Direct Budget Support' 
when amp_funding.amp_modality_id='2' then 'Pool Fund' 
when amp_funding.amp_modality_id='3' then 'Project Support' 
when amp_funding.amp_modality_id='4' then 'Food Aid' 
when amp_funding.amp_modality_id='5' then 'Technical Assistance' 
when amp_funding.amp_modality_id='6' then 'Program Support' else 'Not Exist' end 'modality_name',
amp_activity.amp_status_id,amp_status.name,amp_terms_assist.terms_assist_name,amp_organisation.name
'donor_name',amp_organisation.amp_org_id
'amp_donor_id',amp_organisation.org_type
'org_type',amp_funding.amp_funding_id,
case when transaction_type='0' and adjustment_type='0' and 
org_role_code='MA' then transaction_amount else 0 end 'planned_commitment',
case when transaction_type='1' and adjustment_type='0' and 
org_role_code='MA' then transaction_amount else 0 end 'planned_disbursement',
case when transaction_type='2' and adjustment_type='0' and 
org_role_code='MA' then transaction_amount else 0 end 'planned_expenditure',
case when transaction_type='0' and adjustment_type='1' and 
org_role_code='MA' then transaction_amount else 0 end 'actual_commitment',
case when transaction_type='1' and adjustment_type='1' and 
org_role_code='MA' then transaction_amount else 0 end 'actual_disbursement',
case when transaction_type='2' and adjustment_type='1' and 
org_role_code='MA' then transaction_amount else 0 end 'actual_expenditure',
currency_code,amp_activity.actual_start_date,amp_activity.actual_completion_date,amp_activity.proposed_start_date,
amp_activity.proposed_approval_date,extract(YEAR from 
transaction_date) 'fiscal_year',case when extract(MONTH from 
transaction_date) between '1' and '3' then '1' 
when extract(MONTH from transaction_date) between '4' and '6' then '2' 
when extract(MONTH from transaction_date) between '7' and '9' then '3' 
when extract(MONTH from transaction_date) between '10' and '12' then '4' 
end 'fiscal_quarter',org_role_code 'perspective',amp_team_id ,
transaction_date 'transaction_date' ,amp_activity.amp_level_id,case when amp_activity.amp_level_id='1' then 'REGIONAL' 
when amp_activity.amp_level_id='2' then 'NATIONAL' 
when amp_activity.amp_level_id='3' then 'BOTH' else 'Not Exist' end 
'level_name',amp_activity.description, 
NULL , NULL , NULL , NULL , 1 
from amp_activity LEFT JOIN amp_funding ON 
amp_activity.amp_activity_id=amp_funding.amp_activity_id,amp_funding_detail, 
amp_terms_assist,amp_organisation, amp_currency ,amp_status
where (amp_funding.amp_modality_id is null or amp_activity.amp_level_id is null) 
and amp_funding.amp_funding_id=amp_funding_detail.amp_funding_id 
and amp_funding.amp_donor_org_id=amp_organisation.amp_org_id 
and amp_funding.amp_terms_assist_id=amp_terms_assist.amp_terms_assist_id 
and amp_funding_detail.amp_currency_id=amp_currency.amp_currency_id 
and amp_activity.amp_status_id=amp_status.amp_status_id
and org_role_code='MA';

=============================================================================

insert into amp_report_cache
select '',amp_activity.amp_activity_id,amp_id,amp_activity.name 'activity_name',
NULL 'amp_modality_id', NULL 'modality_name',amp_activity.amp_status_id 'amp_status_id',amp_status.name 'status_name',
NULL 'term_assist_name',NULL 'donor_name',NULL 'amp_donor_id',NULL 'org_type',NULL 'amp_funding_id',
case when transaction_type='0' and adjustment_type='0' and perspective_id='2' then transaction_amount else 0 end 'planned_commitment',
case when transaction_type='1' and adjustment_type='0' and perspective_id='2' then transaction_amount else 0 end 'planned_disbursement',
case when transaction_type='2' and adjustment_type='0' and perspective_id='2' then transaction_amount else 0 end 'planned_expenditure',
case when transaction_type='0' and adjustment_type='1' and perspective_id='2' then transaction_amount else 0 end 'actual_commitment',
case when transaction_type='1' and adjustment_type='1' and perspective_id='2' then transaction_amount else 0 end 'actual_disbursement',
case when transaction_type='2' and adjustment_type='1' and perspective_id='2' then transaction_amount else 0 end 'actual_expenditure',
currency_code,amp_activity.actual_start_date,amp_activity.actual_completion_date,amp_activity.proposed_start_date,
amp_activity.proposed_approval_date,extract(YEAR from transaction_date) 'fiscal_year',
case when extract(MONTH from transaction_date) between '1' and '3' then '1'
when extract(MONTH from transaction_date) between '4' and '6' then '2'
when extract(MONTH from transaction_date) between '7' and '9' then '3'
when extract(MONTH from transaction_date) between '10' and '12' then '4' end 'fiscal_quarter',
'MA',amp_team_id,transaction_date 'transaction_date',amp_activity.amp_level_id,amp_level.name,amp_activity.description, 
amp_components.amp_component_id,amp_components.title , NULL , NULL, 2  
from amp_activity,amp_components,amp_component_funding,amp_status,amp_currency,amp_level
where amp_activity.amp_activity_id=amp_components.amp_activity_id
and amp_components.amp_component_id=amp_component_funding.amp_component_id
and amp_activity.amp_status_id =amp_status.amp_status_id
and amp_component_funding.currency_id=amp_currency.amp_currency_id 
and amp_activity.amp_level_id=amp_level.amp_level_id and perspective_id='2';



insert into amp_report_cache
select '',amp_activity.amp_activity_id,amp_id,amp_activity.name 'activity_name',
NULL 'amp_modality_id', NULL 'modality_name',amp_activity.amp_status_id 'amp_status_id',amp_status.name 'status_name',
NULL 'term_assist_name',NULL 'donor_name',NULL 'amp_donor_id',NULL 'org_type',NULL 'amp_funding_id',
case when transaction_type='0' and adjustment_type='0' and perspective_id='1' then transaction_amount else 0 end 'planned_commitment',
case when transaction_type='1' and adjustment_type='0' and perspective_id='1' then transaction_amount else 0 end 'planned_disbursement',
case when transaction_type='2' and adjustment_type='0' and perspective_id='1' then transaction_amount else 0 end 'planned_expenditure',
case when transaction_type='0' and adjustment_type='1' and perspective_id='1' then transaction_amount else 0 end 'actual_commitment',
case when transaction_type='1' and adjustment_type='1' and perspective_id='1' then transaction_amount else 0 end 'actual_disbursement',
case when transaction_type='2' and adjustment_type='1' and perspective_id='1' then transaction_amount else 0 end 'actual_expenditure',
currency_code,amp_activity.actual_start_date,amp_activity.actual_completion_date,amp_activity.proposed_start_date,
amp_activity.proposed_approval_date,extract(YEAR from transaction_date) 'fiscal_year',
case when extract(MONTH from transaction_date) between '1' and '3' then '1'
when extract(MONTH from transaction_date) between '4' and '6' then '2'
when extract(MONTH from transaction_date) between '7' and '9' then '3'
when extract(MONTH from transaction_date) between '10' and '12' then '4' end 'fiscal_quarter',
'DN',amp_team_id,transaction_date 'transaction_date',amp_activity.amp_level_id,amp_level.name,amp_activity.description, 
amp_components.amp_component_id,amp_components.title , NULL , NULL, 2  
from amp_activity,amp_components,amp_component_funding,amp_status,amp_currency,amp_level
where amp_activity.amp_activity_id=amp_components.amp_activity_id
and amp_components.amp_component_id=amp_component_funding.amp_component_id
and amp_activity.amp_status_id =amp_status.amp_status_id
and amp_component_funding.currency_id=amp_currency.amp_currency_id 
and amp_activity.amp_level_id=amp_level.amp_level_id and perspective_id='1';


insert into amp_report_cache
select '',amp_activity.amp_activity_id,amp_id,amp_activity.name 'activity_name',
NULL 'amp_modality_id', NULL 'modality_name',amp_activity.amp_status_id 'amp_status_id',amp_status.name 'status_name',
NULL 'term_assist_name',NULL 'donor_name',NULL 'amp_donor_id',NULL 'org_type',NULL 'amp_funding_id',
0 'planned_commitment',0 'planned_disbursement',0 'planned_expenditure',0 'actual_commitment',0 'actual_disbursement',0 'actual_expenditure',
NULL,amp_activity.actual_start_date,amp_activity.actual_completion_date,amp_activity.proposed_start_date,
amp_activity.proposed_approval_date,NULL 'fiscal_year',
NULL 'fiscal_quarter',
'MA',amp_team_id,NULL 'transaction_date',amp_activity.amp_level_id,amp_level.name,amp_activity.description, 
NULL,NULL, NULL, NULL, 2  
from amp_activity LEFT JOIN amp_components ON
amp_activity.amp_activity_id=amp_components.amp_activity_id,amp_status,amp_level
where amp_activity.amp_status_id =amp_status.amp_status_id
and amp_activity.amp_level_id=amp_level.amp_level_id and amp_components.amp_activity_id is null;


insert into amp_report_cache
select '',amp_activity.amp_activity_id,amp_id,amp_activity.name 'activity_name',
NULL 'amp_modality_id', NULL 'modality_name',amp_activity.amp_status_id 'amp_status_id',amp_status.name 'status_name',
NULL 'term_assist_name',NULL 'donor_name',NULL 'amp_donor_id',NULL 'org_type',NULL 'amp_funding_id',
0 'planned_commitment',0 'planned_disbursement',0 'planned_expenditure',0 'actual_commitment',0 'actual_disbursement',0 'actual_expenditure',
NULL,amp_activity.actual_start_date,amp_activity.actual_completion_date,amp_activity.proposed_start_date,
amp_activity.proposed_approval_date,NULL 'fiscal_year',
NULL 'fiscal_quarter',
'DN',amp_team_id,NULL 'transaction_date',amp_activity.amp_level_id,amp_level.name,amp_activity.description, 
NULL,NULL , NULL , NULL , 2 
from amp_activity LEFT JOIN amp_components ON
amp_activity.amp_activity_id=amp_components.amp_activity_id,amp_status,amp_level
where amp_activity.amp_status_id =amp_status.amp_status_id
and amp_activity.amp_level_id=amp_level.amp_level_id and amp_components.amp_activity_id is null;


insert into amp_report_cache
select '',amp_activity.amp_activity_id,amp_id,amp_activity.name 'activity_name',
NULL 'amp_modality_id', NULL 'modality_name',amp_activity.amp_status_id 'amp_status_id',amp_status.name 'status_name',
NULL 'term_assist_name',NULL 'donor_name',NULL 'amp_donor_id',NULL 'org_type',NULL 'amp_funding_id',
case when transaction_type='0' and adjustment_type='0' and perspective_id='2' then transaction_amount else 0 end 'planned_commitment',
case when transaction_type='1' and adjustment_type='0' and perspective_id='2' then transaction_amount else 0 end 'planned_disbursement',
case when transaction_type='2' and adjustment_type='0' and perspective_id='2' then transaction_amount else 0 end 'planned_expenditure',
case when transaction_type='0' and adjustment_type='1' and perspective_id='2' then transaction_amount else 0 end 'actual_commitment',
case when transaction_type='1' and adjustment_type='1' and perspective_id='2' then transaction_amount else 0 end 'actual_disbursement',
case when transaction_type='2' and adjustment_type='1' and perspective_id='2' then transaction_amount else 0 end 'actual_expenditure',
currency_code,amp_activity.actual_start_date,amp_activity.actual_completion_date,amp_activity.proposed_start_date,
amp_activity.proposed_approval_date,extract(YEAR from transaction_date) 'fiscal_year',
case when extract(MONTH from transaction_date) between '1' and '3' then '1'
when extract(MONTH from transaction_date) between '4' and '6' then '2'
when extract(MONTH from transaction_date) between '7' and '9' then '3'
when extract(MONTH from transaction_date) between '10' and '12' then '4' end 'fiscal_quarter',
'MA',amp_team_id,transaction_date 'transaction_date',amp_activity.amp_level_id,amp_level.name,amp_activity.description, 
NULL,NULL , amp_region_id, amp_region.name , 3  
from amp_activity,amp_region,amp_regional_funding,amp_status,amp_currency,amp_level
where amp_activity.amp_activity_id=amp_regional_funding.activity_id
and amp_regional_funding.region_id=amp_region.amp_region_id
and amp_activity.amp_status_id =amp_status.amp_status_id
and amp_regional_funding.currency_id=amp_currency.amp_currency_id 
and amp_activity.amp_level_id=amp_level.amp_level_id and perspective_id='2';



insert into amp_report_cache
select '',amp_activity.amp_activity_id,amp_id,amp_activity.name 'activity_name',
NULL 'amp_modality_id', NULL 'modality_name',amp_activity.amp_status_id 'amp_status_id',amp_status.name 'status_name',
NULL 'term_assist_name',NULL 'donor_name',NULL 'amp_donor_id',NULL 'org_type',NULL 'amp_funding_id',
case when transaction_type='0' and adjustment_type='0' and perspective_id='1' then transaction_amount else 0 end 'planned_commitment',
case when transaction_type='1' and adjustment_type='0' and perspective_id='1' then transaction_amount else 0 end 'planned_disbursement',
case when transaction_type='2' and adjustment_type='0' and perspective_id='1' then transaction_amount else 0 end 'planned_expenditure',
case when transaction_type='0' and adjustment_type='1' and perspective_id='1' then transaction_amount else 0 end 'actual_commitment',
case when transaction_type='1' and adjustment_type='1' and perspective_id='1' then transaction_amount else 0 end 'actual_disbursement',
case when transaction_type='2' and adjustment_type='1' and perspective_id='1' then transaction_amount else 0 end 'actual_expenditure',
currency_code,amp_activity.actual_start_date,amp_activity.actual_completion_date,amp_activity.proposed_start_date,
amp_activity.proposed_approval_date,extract(YEAR from transaction_date) 'fiscal_year',
case when extract(MONTH from transaction_date) between '1' and '3' then '1'
when extract(MONTH from transaction_date) between '4' and '6' then '2'
when extract(MONTH from transaction_date) between '7' and '9' then '3'
when extract(MONTH from transaction_date) between '10' and '12' then '4' end 'fiscal_quarter',
'DN',amp_team_id,transaction_date 'transaction_date',amp_activity.amp_level_id,amp_level.name,amp_activity.description, 
NULL ,NULL , amp_region_id, amp_region.name, 3  
from amp_activity,amp_region,amp_regional_funding,amp_status,amp_currency,amp_level
where amp_activity.amp_activity_id=amp_regional_funding.activity_id
and amp_regional_funding.region_id=amp_region.amp_region_id
and amp_activity.amp_status_id =amp_status.amp_status_id
and amp_regional_funding.currency_id=amp_currency.amp_currency_id 
and amp_activity.amp_level_id=amp_level.amp_level_id and perspective_id='1';


insert into amp_report_cache
select '',amp_activity.amp_activity_id,amp_id,amp_activity.name 'activity_name',
NULL 'amp_modality_id', NULL 'modality_name',amp_activity.amp_status_id 'amp_status_id',amp_status.name 'status_name',
NULL 'term_assist_name',NULL 'donor_name',NULL 'amp_donor_id',NULL 'org_type',NULL 'amp_funding_id',
0 'planned_commitment',0 'planned_disbursement',0 'planned_expenditure',0 'actual_commitment',0 'actual_disbursement',0 'actual_expenditure',
NULL,amp_activity.actual_start_date,amp_activity.actual_completion_date,amp_activity.proposed_start_date,
amp_activity.proposed_approval_date,NULL 'fiscal_year',
NULL 'fiscal_quarter',
'MA',amp_team_id,NULL 'transaction_date',amp_activity.amp_level_id,amp_level.name,amp_activity.description, 
NULL,NULL , NULL , NULL , 3  
from amp_activity LEFT JOIN amp_regional_funding ON
amp_activity.amp_activity_id=amp_regional_funding.activity_id,
amp_status,amp_level
where amp_activity.amp_status_id =amp_status.amp_status_id
and amp_activity.amp_level_id=amp_level.amp_level_id and activity_id is null ;


insert into amp_report_cache
select '',amp_activity.amp_activity_id,amp_id,amp_activity.name 'activity_name',
NULL 'amp_modality_id', NULL 'modality_name',amp_activity.amp_status_id 'amp_status_id',amp_status.name 'status_name',
NULL 'term_assist_name',NULL 'donor_name',NULL 'amp_donor_id',NULL 'org_type',NULL 'amp_funding_id',
0 'planned_commitment',0 'planned_disbursement',0 'planned_expenditure',0 'actual_commitment',0 'actual_disbursement',0 'actual_expenditure',
NULL,amp_activity.actual_start_date,amp_activity.actual_completion_date,amp_activity.proposed_start_date,
amp_activity.proposed_approval_date,NULL 'fiscal_year',
NULL 'fiscal_quarter',
'DN',amp_team_id,NULL 'transaction_date',amp_activity.amp_level_id,amp_level.name,amp_activity.description, 
NULL ,NULL , NULL , NULL , 3  
from amp_activity LEFT JOIN amp_regional_funding ON
amp_activity.amp_activity_id=amp_regional_funding.activity_id,
amp_status,amp_level
where amp_activity.amp_status_id =amp_status.amp_status_id
and amp_activity.amp_level_id=amp_level.amp_level_id and activity_id is null;


===========================

amp_report_donor

select activity,organisation,name
from amp_org_role,amp_organisation
where amp_org_role.organisation=amp_organisation.amp_org_id
and role='1'
order by activity,name;


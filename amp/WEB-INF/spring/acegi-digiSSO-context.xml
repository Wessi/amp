<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd">

<!--
- Acegi managed beans.
-->
<beans>
  <bean id="inMemoryAuthenticationDao" class="org.springframework.security.userdetails.memory.InMemoryDaoImpl">
    <property name="userMap">
      <value>
      anzori=badri, ROLE_DIRECTOR
      tamara=natela, ROLE_EXPERT
      natela=vajika, ROLE_EXPERT
      </value>
    </property>
  </bean>

  <bean id="daoAuthenticationProvider" class="org.springframework.security.providers.dao.DaoAuthenticationProvider">
    <property name="userDetailsService">
      <ref bean="inMemoryAuthenticationDao" />
    </property>
  </bean>

  <bean id="authenticationManager" class="org.springframework.security.providers.ProviderManager">
    <property name="providers">
      <list>
        <ref bean="daoAuthenticationProvider" />
      </list>
    </property>
  </bean>

  <bean id="roleVoter" class="org.springframework.security.vote.RoleVoter" />

  <bean id="accessDecisionManager" class="org.springframework.security.vote.UnanimousBased">
    <property name="decisionVoters">
      <list>
        <ref bean="roleVoter" />
      </list>
    </property>
  </bean>

  <bean id="securityInterceptor" class="org.springframework.security.intercept.web.FilterSecurityInterceptor">
    <property name="authenticationManager">
      <ref bean="authenticationManager" />
    </property>
    <property name="accessDecisionManager">
      <ref bean="accessDecisionManager" />
    </property>
    <property name="objectDefinitionSource">
      <value>
      CONVERT_URL_TO_LOWERCASE_BEFORE_COMPARISION
      PATTERN_TYPE_APACHE_ANT
      /faces/**=ROLE_EXPERT
      </value>
    </property>
  </bean>

<!--
  <bean id="authenticationProcessingFilterEntryPoint" class="org.springframework.security.ui.webapp.AuthenticationProcessingFilterEntryPoint">
    <property name="loginFormUrl">
      <value>/login.jsp</value>
    </property>
  </bean>
-->
  <!--
  <bean id="rememberMeServices" class="org.springframework.security.ui.rememberme.NullRememberMeServices" />
  -->
<!--
  <bean id="authenticationProcessingFilter" class="org.springframework.security.ui.webapp.AuthenticationProcessingFilter">
    <property name="filterProcessesUrl">
      <value>/j_acegi_security_check</value>
    </property>
    <property name="authenticationFailureUrl">
      <value>/login.jsp?failed=true</value>
    </property>
    <property name="defaultTargetUrl">
      <value>/</value>
    </property>
    <property name="authenticationManager">
      <ref bean="authenticationManager" />
    </property>
  </bean>
-->
  <bean id="authenticationProcessingFilter" class="org.digijava.kernel.security.auth.DigiSSOProcessingFilter" />


  <bean id="logoutFilter" class="org.springframework.security.ui.logout.LogoutFilter">
    <constructor-arg value="/login.jsp"/> <!-- URL redirected to after logout -->
    <constructor-arg>
      <list>
        <bean class="org.springframework.security.ui.logout.SecurityContextLogoutHandler"/>
      </list>
    </constructor-arg>
    <property name="filterProcessesUrl">
      <value>/j_spring_logout</value>
    </property>
</bean>

<bean id="filterChainProxy" class="org.springframework.security.util.FilterChainProxy">
  <property name="filterInvocationDefinitionSource">
    <value>
    CONVERT_URL_TO_LOWERCASE_BEFORE_COMPARISON
    PATTERN_TYPE_APACHE_ANT
    /**=httpSessionContextIntegrationFilter, logoutFilter, authenticationProcessingFilter, exceptionTranslationFilter, digiAuthenticationFilter
    </value>
  </property>
</bean>

<bean id="httpSessionContextIntegrationFilter" class="org.springframework.security.context.HttpSessionContextIntegrationFilter">
  <property name="allowSessionCreation"><value>true</value></property>
  <property name="context">
    <value>org.springframework.security.context.SecurityContextImpl</value>
  </property>
</bean>

<bean id="exceptionTranslationFilter" class="org.springframework.security.ui.ExceptionTranslationFilter">
  <property name="authenticationEntryPoint">
    <ref local="digiAuthenticationProcessingFilterEntryPoint"/>
   </property>
   <property name="accessDeniedHandler">
      <bean class="org.springframework.security.ui.AccessDeniedHandlerImpl">
        <property name="errorPage" value="/403.jsp"/>
      </bean>
   </property>
</bean>

  <!-- 
     This name is MANDATORY for authentication entry point, because it is 
     hard-coded in some non-spring managed code. For example - RequestProcessor
  -->
  <bean id="digiAuthenticationProcessingFilterEntryPoint" class="org.digijava.kernel.security.auth.DigiSSOAuthenticationEntryPoint" />

  <bean id="digiAuthenticationFilter" class="org.digijava.kernel.security.auth.SSOAuthenticationFilter">
    <property name="digiStyleLogin">
      <value>true</value>
    </property>
    <property name="excludedUrlPatters">
      <list>
        <value>/servlet/.*</value>
        <value>/services/.*</value>
        <value>.*.rss.*</value>
        <value>.*logonAction.do.*</value>
        <value>.*login.do.*</value>
        <value>.*j_acegi_digi_processing_filter.*</value>
      </list>
    </property>
  </bean>
</beans>

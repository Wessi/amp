// Generated by delombok at Mon Mar 24 00:10:06 EET 2014
package org.digijava.module.fundingpledges.form;

import org.digijava.module.aim.dbentity.AmpCurrency;
import org.digijava.module.aim.util.CurrencyUtil;
import org.digijava.module.aim.util.Identifiable;
import org.digijava.module.categorymanager.dbentity.AmpCategoryValue;
import org.digijava.module.categorymanager.util.CategoryManagerUtil;
import org.digijava.module.fundingpledges.dbentity.FundingPledges;
import org.digijava.module.fundingpledges.dbentity.FundingPledgesDetails;

public class FundingPledgesDetailsShim implements UniquelyIdentifiable {
	private Long pledgeTypeId;
	private Long typeOfAssistanceId;
	private Long aidModalityId;
	private Double amount;
	private Long currencyId;
	private Long fundingYear;
	private long uniqueId = PledgeForm.uniqueIds.getAndIncrement();
	private Long fundingYearEnd;
	
	public FundingPledgesDetailsShim(AmpCurrency currency) {
		this.amount = 0.0;
		this.currencyId = currency.getAmpCurrencyId();
	}
	
	public FundingPledgesDetailsShim(FundingPledgesDetails fpd) {
		this.pledgeTypeId = getIdFrom(fpd.getPledgetype());
		this.typeOfAssistanceId = getIdFrom(fpd.getTypeOfAssistance());
		this.aidModalityId = getIdFrom(fpd.getAidmodality());
		this.amount = fpd.getAmount();
		this.currencyId = getIdFrom(fpd.getCurrency());
		this.fundingYear = getLongFrom(fpd.getFundingYear());
		this.fundingYearEnd = fpd.getFundingYearEnd();
		if (fundingYearEnd == null || fundingYearEnd < fundingYear) // if not funding-year-end is specified or an invalid value is specified, copy the funding-year-start value
			this.fundingYearEnd = fundingYear;
	}
	
	public FundingPledgesDetails buildFundingPledgesDetail(FundingPledges pledge){
		FundingPledgesDetails fps = new FundingPledgesDetails();
		fps.setPledgeid(pledge);
		fps.setAmount(this.getAmount());
		fps.setAidmodality(CategoryManagerUtil.loadAcvOrNull(this.getAidModalityId()));
		fps.setCurrency(this.getCurrencyId() == null ? null : CurrencyUtil.getAmpcurrency(this.getCurrencyId()));
		fps.setFundingYear(this.getFundingYear() == null ? null : this.getFundingYear().toString());
		fps.setFundingYearEnd(this.getFundingYearEnd());
		fps.setPledgetype(CategoryManagerUtil.loadAcvOrNull(this.getPledgeTypeId()));
		fps.setTypeOfAssistance(CategoryManagerUtil.loadAcvOrNull(this.getTypeOfAssistanceId()));
		return fps;
	}
	
	public String getCurrencyCode(){
		return currencyId == null ? null : CurrencyUtil.getCurrency(this.currencyId).getCurrencyCode();
	}
	
	public static Long getIdFrom(Identifiable id) {
		return id == null ? null : (Long)id.getIdentifier();
	}
	
	public static Long getLongFrom(String z) {
		if (z == null) return null;
		try {
			return Long.parseLong(z);
		} catch (Exception e) {
			return null;
		}
	}
	
	@Override public String toString(){
		return String.format("%.2f curr: %s, ToA: %d, fundingYear: %d, pledgeTypeId: %d", this.amount, this.currencyId, this.typeOfAssistanceId, this.fundingYear, this.pledgeTypeId);
	}
		
	@java.lang.SuppressWarnings("all")
	public Long getPledgeTypeId() {
		return this.pledgeTypeId;
	}
	
	@java.lang.SuppressWarnings("all")
	public Long getTypeOfAssistanceId() {
		return this.typeOfAssistanceId;
	}
	
	@java.lang.SuppressWarnings("all")
	public Long getAidModalityId() {
		return this.aidModalityId;
	}
	
	@java.lang.SuppressWarnings("all")
	public Double getAmount() {
		return this.amount;
	}
	
	@java.lang.SuppressWarnings("all")
	public Long getCurrencyId() {
		return this.currencyId;
	}
	
	@java.lang.SuppressWarnings("all")
	public Long getFundingYear() {
		return this.fundingYear;
	}
	
	@java.lang.SuppressWarnings("all")
	public long getUniqueId() {
		return this.uniqueId;
	}
	
	@java.lang.SuppressWarnings("all")
	public void setPledgeTypeId(final Long pledgeTypeId) {
		this.pledgeTypeId = pledgeTypeId;
	}
	
	@java.lang.SuppressWarnings("all")
	public void setTypeOfAssistanceId(final Long typeOfAssistanceId) {
		this.typeOfAssistanceId = typeOfAssistanceId;
	}
	
	@java.lang.SuppressWarnings("all")
	public void setAidModalityId(final Long aidModalityId) {
		this.aidModalityId = aidModalityId;
	}
	
	@java.lang.SuppressWarnings("all")
	public void setAmount(final Double amount) {
		this.amount = amount;
	}
	
	@java.lang.SuppressWarnings("all")
	public void setCurrencyId(final Long currencyId) {
		this.currencyId = currencyId;
	}
	
	@java.lang.SuppressWarnings("all")
	public void setFundingYear(final Long fundingYear) {
		this.fundingYear = fundingYear;
	}
	
	public Long getFundingYearEnd() {
		return fundingYearEnd;
	}

	public void setFundingYearEnd(Long fundingYearEnd) {
		this.fundingYearEnd = fundingYearEnd;
	}

	@java.lang.SuppressWarnings("all")
	public void setUniqueId(final long uniqueId) {
		this.uniqueId = uniqueId;
	}
}
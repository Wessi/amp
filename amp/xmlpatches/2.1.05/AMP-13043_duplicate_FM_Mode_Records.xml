<?xml version="1.0" encoding="UTF-8"?>
<tns:patch closeOnSuccess="true" retryOnFail="true"	xmlns:tns="http://docs.ampdev.net/schemas/xmlpatcher" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://docs.ampdev.net/schemas/xmlpatcher ../doc/xmlpatcher.xsd ">
	<jira>AMP-13043</jira>
	<keyword>FM</keyword>
	<author>Dare</author>
	<description>Remove duplicate entries from FM</description>
	
	<trigger type="all">
		<condition type="custom">
			<script returnVar="myCount">
				<lang type="postgres">SELECT count(*) from amp_modules_visibility where name like '/Activity Form/FM Mode'</lang>
			</script>
			<test>myCount>1</test>
		</condition>
	</trigger>
	
	<apply>
		<script>
			<lang delimiter=";" type="postgres">
				delete from amp_modules_templates where module in ( select id from amp_modules_visibility where	name = '/Activity Form/FM Mode') ;
				DELETE FROM amp_modules_visibility 
				 	WHERE  id not in (select min(id) from  amp_modules_visibility where "name" = '/Activity Form/FM Mode')  
				 	and "name" = '/Activity Form/FM Mode';
            </lang>
		</script>
	</apply>
</tns:patch>


<?xml version="1.0" encoding="UTF-8"?>
<tns:patch closeOnSuccess="true" retryOnFail="true"
	xmlns:tns="http://docs.ampdev.net/schemas/xmlpatcher" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://docs.ampdev.net/schemas/xmlpatcher ../doc/xmlpatcher.xsd ">
	<jira>AMP-16005</jira>
	<keyword>Pledges</keyword>
	<author>Ddimunzio</author>
	<description>Have the ability to enter the Agreement / Pledge title as free text instead of using the drop-down that's linked to category manager</description>
	<apply>
		<script>
			<lang delimiter=";" type="postgres">
				DROP VIEW v_pledges_titles;
				CREATE OR REPLACE VIEW v_pledges_titles AS 
  				SELECT (-1) AS pledge_id, 'No Pledge'::character varying AS title, (-1) AS title_id
				UNION 
        			( SELECT p.id AS pledge_id, val.category_value AS title, val.id AS title_id
           			FROM amp_funding_pledges p
      				JOIN amp_category_value val ON p.title = val.id
     				ORDER BY p.id)
			UNION
				(SELECT p.id AS pledge_id, p.titlefreetext,null 
           		FROM amp_funding_pledges p);
			</lang>
		</script>
	</apply>
</tns:patch>
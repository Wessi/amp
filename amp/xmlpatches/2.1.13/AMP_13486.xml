<?xml version="1.0" encoding="UTF-8"?>
<tns:patch closeOnSuccess="true" retryOnFail="true" xmlns:tns="http://docs.ampdev.net/schemas/xmlpatcher" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://docs.ampdev.net/schemas/xmlpatcher ../doc/xmlpatcher.xsd ">
  <jira>AMP-13486</jira>
  <keyword>regions </keyword>
  <author>Alex</author>
  <description>regions names should in reports should come from amp_category_value_location</description>
  

	
  <apply>
    <script>
      <lang delimiter=";" type="postgres">       
    create or replace view v_regions as 
 SELECT ra.amp_activity_id, getlocationname(getlocationidbyimplloc(l.location_id, 'Region'::character varying))::character varying(255) AS region,  
					getlocationidbyimplloc(l.location_id, 'Region'::character varying) AS region_id, 
					sum(ra.location_percentage) AS location_percentage 
   FROM amp_activity_location ra, amp_location l 
  WHERE ra.amp_location_id = l.amp_location_id AND getlocationidbyimplloc(l.location_id, 'Region'::character varying) IS NOT NULL 
  GROUP BY ra.amp_activity_id, getlocationidbyimplloc(l.location_id, 'Region'::character varying); 
             
    	 </lang>
    </script>
  </apply>

</tns:patch>
<?xml version="1.0" encoding="UTF-8"?>
<tns:patch closeOnSuccess="true" retryOnFail="true"
	xmlns:tns="http://docs.ampdev.net/schemas/xmlpatcher" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://docs.ampdev.net/schemas/xmlpatcher ../doc/xmlpatcher.xsd ">
	<jira>AMP-12413</jira>
	<keyword>Reports</keyword>
	<author>Dare</author>
	<description>Activity Creator/Activity updater views should have the same format for creator/updated</description>
	
	<trigger type="all">
      <condition type="appliedPatch">merge_activity_updatedBy_and_modifiedBy.xml</condition>
  	</trigger>
	
	<apply>
		<script>
			<lang delimiter=";" type="sql">
				CREATE OR REPLACE VIEW v_activity_modified_by AS  SELECT a.amp_activity_id as amp_activity_id,
				u.FIRST_NAMES||' '||u.LAST_NAME||' ('||u.email||')'  as name,atm.user_ as user_id FROM amp_activity_version a, 
				amp_team_member atm, dg_user u	WHERE atm.amp_team_mem_id=a.modified_by AND atm.user_=u.id ORDER BY amp_activity_id;
				
				drop view if exists v_activity_creator;
				
				CREATE OR REPLACE VIEW v_activity_creator AS  select a.amp_activity_id AS amp_activity_id,
         		u.FIRST_NAMES||' '||u.LAST_NAME||' ('||u.email||')' AS user_id from 
         		((amp_activity_version a join amp_team_member atm on (atm.amp_team_mem_id = a.activity_creator) ) join dg_user u on (atm.user_ = u.ID) ) 
         		order by a.amp_activity_id;
			</lang>
		</script>
	</apply>

</tns:patch>
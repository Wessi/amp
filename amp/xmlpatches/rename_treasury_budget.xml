<?xml version="1.0" encoding="UTF-8"?>
<tns:patch closeOnSuccess="true" retryOnFail="true"
	xmlns:tns="http://docs.ampdev.net/schemas/xmlpatcher" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://docs.ampdev.net/schemas/xmlpatcher ../doc/xmlpatcher.xsd ">
	<jira>AMP-10398</jira>
	<keyword>treasure, treasury</keyword>
	<author>mihai</author>
	<description>Treasury is misspelled as 'Treasure' across the system</description>

	<apply>
		<script>
			<lang delimiter=";" type="sql">
UPDATE amp_columns SET columnName='On/Off/Treasury Budget' WHERE columnName='On/Off/Treasure Budget';
UPDATE amp_category_value SET category_value='Treasury' WHERE category_value='Treasure';
UPDATE amp_fields_visibility SET name='On/Off/Treasury Budget' WHERE name='On/Off/Treasure Budget';
</lang>
		</script>

		<script>
			<lang delimiter=";" type="sql">
CREATE or REPLACE VIEW v_on_off_budget AS 
		SELECT a.amp_activity_id AS amp_activity_id,
		CASE WHEN (acv.id is null) THEN 'Unallocated' ELSE CAST (acv.category_value AS text) END AS budget 
		FROM 
		amp_activities_categoryvalues aac  
		 JOIN amp_category_value acv on aac.amp_categoryvalue_id=acv.id 
		 JOIN amp_category_class acc on (acc.id=acv.amp_category_class_id AND acc.keyName='activity_budget')
		 RIGHT JOIN amp_activity a ON  a.amp_activity_id=aac.amp_activity_id
		order by a.amp_activity_id;
</lang>
		</script>
		<script>
			<lang delimiter=";" type="sql">
UPDATE amp_category_value SET category_value='Off Budget' FROM amp_category_class where amp_category_class.id=amp_category_value.amp_category_class_id and amp_category_value.category_value = 'Off' and amp_category_class.keyName='activity_budget';
UPDATE amp_category_value SET category_value='On Budget' FROM amp_category_class where amp_category_class.id=amp_category_value.amp_category_class_id and amp_category_value.category_value = 'On' and amp_category_class.keyName='activity_budget';
      </lang>
		</script>
	</apply>
</tns:patch>


<?xml version="1.0" encoding="UTF-8"?>
<tns:patch closeOnSuccess="true" retryOnFail="true" xmlns:tns="http://docs.ampdev.net/schemas/xmlpatcher" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://docs.ampdev.net/schemas/xmlpatcher ../doc/xmlpatcher.xsd ">
  <jira>AMP-11328</jira>
  <keyword>amp activity view</keyword>
  <author>Alexandru Artimon</author>
  <description>update the amp activity view to exclude activities marked as deleted</description>
  
  <apply>
    <script>
      <lang delimiter=";" type="postgres">
			CREATE or REPLACE VIEW amp_activity AS
			select amp_activity_version.*
			from amp_activity_version, amp_activity_group
			where amp_activity_version.amp_activity_id = amp_activity_group.amp_activity_last_version_id and 
				  (amp_activity_version.deleted is null or amp_activity_version.deleted=false);
      </lang>
    </script>
  </apply>

</tns:patch>

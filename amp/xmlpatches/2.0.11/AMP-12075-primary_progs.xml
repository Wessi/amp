<?xml version="1.0" encoding="UTF-8"?>
<tns:patch closeOnSuccess="true" retryOnFail="true" xmlns:tns="http://docs.ampdev.net/schemas/xmlpatcher" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://docs.ampdev.net/schemas/xmlpatcher ../doc/xmlpatcher.xsd ">
  <jira>AMP-12075</jira>
  <keyword>programs</keyword>
  <author>Alex</author>
  <description>Program views need to sum up percentages from subprograms</description>
  <apply>
    <script>
      <lang delimiter=";" type="postgres">
      		CREATE OR REPLACE VIEW v_primaryprogram_level_0 AS 
SELECT v_primaryprogram_all_level.amp_activity_id, 
        CASE 0
            WHEN v_primaryprogram_all_level.l1 THEN v_primaryprogram_all_level.n1
            WHEN v_primaryprogram_all_level.l2 THEN v_primaryprogram_all_level.n2
            WHEN v_primaryprogram_all_level.l3 THEN v_primaryprogram_all_level.n3
            WHEN v_primaryprogram_all_level.l4 THEN v_primaryprogram_all_level.n4
            WHEN v_primaryprogram_all_level.l5 THEN v_primaryprogram_all_level.n5
            WHEN v_primaryprogram_all_level.l6 THEN v_primaryprogram_all_level.n6
            WHEN v_primaryprogram_all_level.l7 THEN v_primaryprogram_all_level.n7
            WHEN v_primaryprogram_all_level.l8 THEN v_primaryprogram_all_level.n8
            ELSE NULL::character varying
        END AS name, 
        min(v_primaryprogram_all_level.amp_program_id) as amp_program_id, 
        sum(v_primaryprogram_all_level.program_percentage) as program_percentage
   FROM v_primaryprogram_all_level 
   group by amp_activity_id, name;
      		
			CREATE OR REPLACE VIEW v_primaryprogram_level_1 AS 
SELECT v_primaryprogram_all_level.amp_activity_id, 
        CASE 1
            WHEN v_primaryprogram_all_level.l1 THEN v_primaryprogram_all_level.n1
            WHEN v_primaryprogram_all_level.l2 THEN v_primaryprogram_all_level.n2
            WHEN v_primaryprogram_all_level.l3 THEN v_primaryprogram_all_level.n3
            WHEN v_primaryprogram_all_level.l4 THEN v_primaryprogram_all_level.n4
            WHEN v_primaryprogram_all_level.l5 THEN v_primaryprogram_all_level.n5
            WHEN v_primaryprogram_all_level.l6 THEN v_primaryprogram_all_level.n6
            WHEN v_primaryprogram_all_level.l7 THEN v_primaryprogram_all_level.n7
            WHEN v_primaryprogram_all_level.l8 THEN v_primaryprogram_all_level.n8
            ELSE NULL::character varying
        END AS name, 
        min(v_primaryprogram_all_level.amp_program_id) as amp_program_id, 
        sum(v_primaryprogram_all_level.program_percentage) as program_percentage
   FROM v_primaryprogram_all_level 
   group by amp_activity_id, name;
   
   		CREATE OR REPLACE VIEW v_primaryprogram_level_2 AS 
SELECT v_primaryprogram_all_level.amp_activity_id, 
        CASE 2
            WHEN v_primaryprogram_all_level.l1 THEN v_primaryprogram_all_level.n1
            WHEN v_primaryprogram_all_level.l2 THEN v_primaryprogram_all_level.n2
            WHEN v_primaryprogram_all_level.l3 THEN v_primaryprogram_all_level.n3
            WHEN v_primaryprogram_all_level.l4 THEN v_primaryprogram_all_level.n4
            WHEN v_primaryprogram_all_level.l5 THEN v_primaryprogram_all_level.n5
            WHEN v_primaryprogram_all_level.l6 THEN v_primaryprogram_all_level.n6
            WHEN v_primaryprogram_all_level.l7 THEN v_primaryprogram_all_level.n7
            WHEN v_primaryprogram_all_level.l8 THEN v_primaryprogram_all_level.n8
            ELSE NULL::character varying
        END AS name, 
        min(v_primaryprogram_all_level.amp_program_id) as amp_program_id, 
        sum(v_primaryprogram_all_level.program_percentage) as program_percentage
   FROM v_primaryprogram_all_level 
   group by amp_activity_id, name;
   
   CREATE OR REPLACE VIEW v_primaryprogram_level_3 AS 
SELECT v_primaryprogram_all_level.amp_activity_id, 
        CASE 3
            WHEN v_primaryprogram_all_level.l1 THEN v_primaryprogram_all_level.n1
            WHEN v_primaryprogram_all_level.l2 THEN v_primaryprogram_all_level.n2
            WHEN v_primaryprogram_all_level.l3 THEN v_primaryprogram_all_level.n3
            WHEN v_primaryprogram_all_level.l4 THEN v_primaryprogram_all_level.n4
            WHEN v_primaryprogram_all_level.l5 THEN v_primaryprogram_all_level.n5
            WHEN v_primaryprogram_all_level.l6 THEN v_primaryprogram_all_level.n6
            WHEN v_primaryprogram_all_level.l7 THEN v_primaryprogram_all_level.n7
            WHEN v_primaryprogram_all_level.l8 THEN v_primaryprogram_all_level.n8
            ELSE NULL::character varying
        END AS name, 
        min(v_primaryprogram_all_level.amp_program_id) as amp_program_id, 
        sum(v_primaryprogram_all_level.program_percentage) as program_percentage
   FROM v_primaryprogram_all_level 
   group by amp_activity_id, name;
   
   CREATE OR REPLACE VIEW v_primaryprogram_level_4 AS 
SELECT v_primaryprogram_all_level.amp_activity_id, 
        CASE 4
            WHEN v_primaryprogram_all_level.l1 THEN v_primaryprogram_all_level.n1
            WHEN v_primaryprogram_all_level.l2 THEN v_primaryprogram_all_level.n2
            WHEN v_primaryprogram_all_level.l3 THEN v_primaryprogram_all_level.n3
            WHEN v_primaryprogram_all_level.l4 THEN v_primaryprogram_all_level.n4
            WHEN v_primaryprogram_all_level.l5 THEN v_primaryprogram_all_level.n5
            WHEN v_primaryprogram_all_level.l6 THEN v_primaryprogram_all_level.n6
            WHEN v_primaryprogram_all_level.l7 THEN v_primaryprogram_all_level.n7
            WHEN v_primaryprogram_all_level.l8 THEN v_primaryprogram_all_level.n8
            ELSE NULL::character varying
        END AS name, 
        min(v_primaryprogram_all_level.amp_program_id) as amp_program_id, 
        sum(v_primaryprogram_all_level.program_percentage) as program_percentage
   FROM v_primaryprogram_all_level 
   group by amp_activity_id, name;
   
   CREATE OR REPLACE VIEW v_primaryprogram_level_5 AS 
SELECT v_primaryprogram_all_level.amp_activity_id, 
        CASE 5
            WHEN v_primaryprogram_all_level.l1 THEN v_primaryprogram_all_level.n1
            WHEN v_primaryprogram_all_level.l2 THEN v_primaryprogram_all_level.n2
            WHEN v_primaryprogram_all_level.l3 THEN v_primaryprogram_all_level.n3
            WHEN v_primaryprogram_all_level.l4 THEN v_primaryprogram_all_level.n4
            WHEN v_primaryprogram_all_level.l5 THEN v_primaryprogram_all_level.n5
            WHEN v_primaryprogram_all_level.l6 THEN v_primaryprogram_all_level.n6
            WHEN v_primaryprogram_all_level.l7 THEN v_primaryprogram_all_level.n7
            WHEN v_primaryprogram_all_level.l8 THEN v_primaryprogram_all_level.n8
            ELSE NULL::character varying
        END AS name, 
        min(v_primaryprogram_all_level.amp_program_id) as amp_program_id, 
        sum(v_primaryprogram_all_level.program_percentage) as program_percentage
   FROM v_primaryprogram_all_level 
   group by amp_activity_id, name;
   
   CREATE OR REPLACE VIEW v_primaryprogram_level_6 AS 
SELECT v_primaryprogram_all_level.amp_activity_id, 
        CASE 6
            WHEN v_primaryprogram_all_level.l1 THEN v_primaryprogram_all_level.n1
            WHEN v_primaryprogram_all_level.l2 THEN v_primaryprogram_all_level.n2
            WHEN v_primaryprogram_all_level.l3 THEN v_primaryprogram_all_level.n3
            WHEN v_primaryprogram_all_level.l4 THEN v_primaryprogram_all_level.n4
            WHEN v_primaryprogram_all_level.l5 THEN v_primaryprogram_all_level.n5
            WHEN v_primaryprogram_all_level.l6 THEN v_primaryprogram_all_level.n6
            WHEN v_primaryprogram_all_level.l7 THEN v_primaryprogram_all_level.n7
            WHEN v_primaryprogram_all_level.l8 THEN v_primaryprogram_all_level.n8
            ELSE NULL::character varying
        END AS name, 
        min(v_primaryprogram_all_level.amp_program_id) as amp_program_id, 
        sum(v_primaryprogram_all_level.program_percentage) as program_percentage
   FROM v_primaryprogram_all_level 
   group by amp_activity_id, name;
   
   CREATE OR REPLACE VIEW v_primaryprogram_level_7 AS 
SELECT v_primaryprogram_all_level.amp_activity_id, 
        CASE 7
            WHEN v_primaryprogram_all_level.l1 THEN v_primaryprogram_all_level.n1
            WHEN v_primaryprogram_all_level.l2 THEN v_primaryprogram_all_level.n2
            WHEN v_primaryprogram_all_level.l3 THEN v_primaryprogram_all_level.n3
            WHEN v_primaryprogram_all_level.l4 THEN v_primaryprogram_all_level.n4
            WHEN v_primaryprogram_all_level.l5 THEN v_primaryprogram_all_level.n5
            WHEN v_primaryprogram_all_level.l6 THEN v_primaryprogram_all_level.n6
            WHEN v_primaryprogram_all_level.l7 THEN v_primaryprogram_all_level.n7
            WHEN v_primaryprogram_all_level.l8 THEN v_primaryprogram_all_level.n8
            ELSE NULL::character varying
        END AS name, 
        min(v_primaryprogram_all_level.amp_program_id) as amp_program_id, 
        sum(v_primaryprogram_all_level.program_percentage) as program_percentage
   FROM v_primaryprogram_all_level 
   group by amp_activity_id, name;
   
   CREATE OR REPLACE VIEW v_primaryprogram_level_8 AS 
SELECT v_primaryprogram_all_level.amp_activity_id, 
        CASE 8
            WHEN v_primaryprogram_all_level.l1 THEN v_primaryprogram_all_level.n1
            WHEN v_primaryprogram_all_level.l2 THEN v_primaryprogram_all_level.n2
            WHEN v_primaryprogram_all_level.l3 THEN v_primaryprogram_all_level.n3
            WHEN v_primaryprogram_all_level.l4 THEN v_primaryprogram_all_level.n4
            WHEN v_primaryprogram_all_level.l5 THEN v_primaryprogram_all_level.n5
            WHEN v_primaryprogram_all_level.l6 THEN v_primaryprogram_all_level.n6
            WHEN v_primaryprogram_all_level.l7 THEN v_primaryprogram_all_level.n7
            WHEN v_primaryprogram_all_level.l8 THEN v_primaryprogram_all_level.n8
            ELSE NULL::character varying
        END AS name, 
        min(v_primaryprogram_all_level.amp_program_id) as amp_program_id, 
        sum(v_primaryprogram_all_level.program_percentage) as program_percentage
   FROM v_primaryprogram_all_level 
   group by amp_activity_id, name;
      </lang>
    </script>
  </apply>

</tns:patch>

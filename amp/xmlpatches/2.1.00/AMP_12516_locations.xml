<?xml version="1.0" encoding="UTF-8"?>
<tns:patch closeOnSuccess="true" retryOnFail="true" xmlns:tns="http://docs.ampdev.net/schemas/xmlpatcher" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://docs.ampdev.net/schemas/xmlpatcher ../doc/xmlpatcher.xsd ">
    <jira>AMP-12516</jira>
    <keyword>locations</keyword>
    <keyword>sector location</keyword>
    <author>Alex</author>
    <description>Adding multidonor as a column</description>
       <apply>
        <script>
            <lang  delimiter=";" type="postgres">
	CREATE OR REPLACE VIEW v_sectorloc AS  
	  SELECT ra.amp_activity_id, getlocationname(getlocationidbyimplloc(l.location_id, 'Sector Location'::character varying)) AS location_name, 
		getlocationidbyimplloc(l.location_id, 'Sector Location'::character varying) AS location_id, sum(ra.location_percentage) AS location_percentage 
		FROM amp_activity_location ra, amp_location l 
		WHERE ra.amp_location_id = l.amp_location_id AND getlocationidbyimplloc(l.location_id, 'Sector Location'::character varying) IS NOT NULL 
	GROUP BY ra.amp_activity_id, getlocationidbyimplloc(l.location_id, 'Sector Location'::character varying); 

	insert into amp_columns   
   		(columnid,columnName,aliasname,cellType,extractorView, relatedcontentpersisterclass, filterretrievable)  
		values (nextval('amp_columns_seq'), 'Sector Location', 'sectorLoc', 'org.dgfoundation.amp.ar.cell.MetaTextCell','v_sectorloc','org.digijava.module.aim.dbentity.AmpCategoryValueLocations',TRUE);
  
            </lang>
        </script>
    </apply>
</tns:patch>

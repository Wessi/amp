<?xml version="1.0" encoding="UTF-8"?>
<tns:patch closeOnSuccess="true" retryOnFail="true" xmlns:tns="http://docs.ampdev.net/schemas/xmlpatcher" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://docs.ampdev.net/schemas/xmlpatcher ../doc/xmlpatcher.xsd ">
  <jira>AMP-12715</jira>
  <keyword>adjustment type</keyword>
  <keyword>columns</keyword>
  <author>FFerreyra</author>
  <description>Changes needed after putting adjustment type in Category Value.</description>
  <apply>
    <script>
      <lang delimiter=";" type="postgres">
DROP VIEW v_donor_funding;
CREATE OR REPLACE VIEW v_donor_funding (
    amp_activity_id,
    amp_funding_id,
    amp_fund_detail_id,
    donor_name,
    transaction_type,
    adjustment_type,
    adjustment_type_name,
    transaction_date,
    transaction_amount,
    pledge_id,
    currency_code,
    terms_assist_id,
    terms_assist_name,
    fixed_exchange_rate,
    org_grp_name,
    donor_type_name,
    financing_instrument_name,
    financing_instrument_id,
    org_id,
    org_grp_id,
    org_type_id,
    mode_of_payment_name,
    mode_of_payment_id,
    funding_status_name,
    funding_status_id)
AS
SELECT f.amp_activity_id, f.amp_funding_id, fd.amp_fund_detail_id, d.name AS
    donor_name, fd.transaction_type, fd.adjustment_type, cval5.category_value
    AS adjustment_type_name, fd.transaction_date, fd.transaction_amount,
    fd.pledge_id, c.currency_code, cval.id AS terms_assist_id,
    cval.category_value AS terms_assist_name, fd.fixed_exchange_rate,
    b.org_grp_name, ot.org_type AS donor_type_name, cval2.category_value AS
    financing_instrument_name, cval2.id AS financing_instrument_id,
    d.amp_org_id AS org_id, d.org_grp_id, ot.amp_org_type_id AS org_type_id,
    cval3.category_value AS mode_of_payment_name, cval3.id AS
    mode_of_payment_id, cval4.category_value AS funding_status_name, cval4.id
    AS funding_status_id
FROM ((amp_funding f LEFT JOIN amp_category_value cval3 ON
    ((f.mode_of_payment_category_va = cval3.id))) LEFT JOIN amp_category_value
    cval4 ON ((f.funding_status_category_va = cval4.id))), (amp_funding_detail
    fd LEFT JOIN amp_category_value cval5 ON ((fd.adjustment_type =
    cval5.id))), amp_category_value cval, amp_currency c, amp_organisation d,
    amp_org_group b, amp_org_type ot, amp_category_value cval2
WHERE (((((((cval2.id = f.financing_instr_category_value) AND
    (c.amp_currency_id = fd.amp_currency_id)) AND (f.amp_funding_id =
    fd.amp_funding_id)) AND (cval.id = f.type_of_assistance_category_va)) AND
    (d.amp_org_id = f.amp_donor_org_id)) AND (d.org_grp_id = b.amp_org_grp_id))
    AND (ot.amp_org_type_id = b.org_type))
ORDER BY f.amp_activity_id;

      </lang>
    </script>
  </apply>

</tns:patch>

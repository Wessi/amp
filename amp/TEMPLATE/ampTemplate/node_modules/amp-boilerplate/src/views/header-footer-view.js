var fs = require('fs');
var $ = require('jquery');
var Backbone = require('backbone');
var _ = require('underscore');

var Template = fs.readFileSync(__dirname + '/../templates/footer-template.html', 'utf8');
var UserModel = require('../models/amp-user-model.js');

module.exports = Backbone.View.extend({
	  model : null,
	  template: _.template(Template),
	  el: '#amp-footer',
	  userFetched : new $.Deferred(),

	  initialize: function(options) {
	    var userModel = new UserModel();
	    var self = this;
	    userModel.fetch().then(function(user) {
	    	self.model = user;
	    	self.render();
	    	self.userFetched.resolve();
	    });
	    _.bindAll(this, 'render','refreshUserSection');
	 
	  },
	  render: function() {
		  if (this.model) {
			  this.refreshUserSection ();
			  var self = this;
			  this.$el.html(this.template({
		       properties: self.model,
		      }));
		  }
	      return this;
	    },
	  refreshUserSection:function () {
		  if (this.model.email) {
		        $('.container-fluid',$('#amp-header')).toggleClass('ampUserLoggedIn');
		        $('#header-workspace', $('#amp-header')).text(this.model.workspace);
		        $('#header-name #header-first-name', $('#amp-header')).text(this.model.firstName);
		        $('#header-name #header-last-name', $('#amp-header')).text(this.model.lastName);
		  }
	    	
	    }


	});


/**
 * Backbone localStorage Adapter
 * Version 1.1.13
 *
 * https://github.com/jeromegn/Backbone.localStorage
 */(function(e,t){if(typeof exports==="object"&&typeof require==="function"){module.exports=t(require("backbone"))}else if(typeof define==="function"&&define.amd){define(["backbone"],function(r){return t(r||e.Backbone)})}else{t(Backbone)}})(this,function(e){function t(){return((1+Math.random())*65536|0).toString(16).substring(1)}function r(){return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()}function i(e){return e===Object(e)}function o(e,t){var r=e.length;while(r--)if(e[r]===t)return true;return false}function n(e,t){for(var r in t)e[r]=t[r];return e}e.LocalStorage=window.Store=function(e,t){if(!this.localStorage){throw"Backbone.localStorage: Environment does not support localStorage."}this.name=e;this.serializer=t||{serialize:function(e){return i(e)?JSON.stringify(e):e},deserialize:function(e){return e&&JSON.parse(e)}};var r=this.localStorage().getItem(this.name);this.records=r&&r.split(",")||[]};n(e.LocalStorage.prototype,{save:function(){this.localStorage().setItem(this.name,this.records.join(","))},create:function(e){if(!e.id){e.id=r();e.set(e.idAttribute,e.id)}this.localStorage().setItem(this._itemName(e.id),this.serializer.serialize(e));this.records.push(e.id.toString());this.save();return this.find(e)!==false},update:function(e){this.localStorage().setItem(this._itemName(e.id),this.serializer.serialize(e));var t=e.id.toString();if(!o(this.records,t)){this.records.push(t);this.save()}return this.find(e)!==false},find:function(e){return this.serializer.deserialize(this.localStorage().getItem(this._itemName(e.id)))},findAll:function(){var e=[];for(var t=0,r,i;t<this.records.length;t++){r=this.records[t];i=this.serializer.deserialize(this.localStorage().getItem(this._itemName(r)));if(i!=null)e.push(i)}return e},destroy:function(e){this.localStorage().removeItem(this._itemName(e.id));var t=e.id.toString();for(var r=0,i;r<this.records.length;r++){if(this.records[r]===t){this.records.splice(r,1)}}this.save();return e},localStorage:function(){return localStorage},_clear:function(){var e=this.localStorage(),t=new RegExp("^"+this.name+"-");e.removeItem(this.name);for(var r in e){if(t.test(r)){e.removeItem(r)}}this.records.length=0},_storageSize:function(){return this.localStorage().length},_itemName:function(e){return this.name+"-"+e}});e.LocalStorage.sync=window.Store.sync=e.localSync=function(t,r,i){var o=r.localStorage||r.collection.localStorage;var n,s;var a=e.$?e.$.Deferred&&e.$.Deferred():e.Deferred&&e.Deferred();try{switch(t){case"read":n=r.id!=undefined?o.find(r):o.findAll();break;case"create":n=o.create(r);break;case"update":n=o.update(r);break;case"delete":n=o.destroy(r);break}}catch(c){if(c.code===22&&o._storageSize()===0)s="Private browsing is unsupported";else s=c.message}if(n){if(i&&i.success){if(e.VERSION==="0.9.10"){i.success(r,n,i)}else{i.success(n)}}if(a){a.resolve(n)}}else{s=s?s:"Record Not Found";if(i&&i.error)if(e.VERSION==="0.9.10"){i.error(r,s,i)}else{i.error(s)}if(a)a.reject(s)}if(i&&i.complete)i.complete(n);return a&&a.promise()};e.ajaxSync=e.sync;e.getSyncMethod=function(t){if(t.localStorage||t.collection&&t.collection.localStorage){return e.localSync}return e.ajaxSync};e.sync=function(t,r,i){return e.getSyncMethod(r).apply(this,[t,r,i])};return e.LocalStorage});
<%@ taglib uri="/taglib/struts-bean" prefix="bean" %>
<%@ taglib uri="/taglib/struts-logic" prefix="logic" %>
<%@ taglib uri="/taglib/struts-tiles" prefix="tiles" %>
<%@ taglib uri="/taglib/struts-html" prefix="html" %>
<%@ taglib uri="/taglib/digijava" prefix="digi" %>
<%@ taglib uri="/taglib/jstl-core" prefix="c" %>
<%@ taglib uri="/taglib/struts-nested" prefix="nested" %>
<%@ taglib uri="/taglib/fieldVisibility" prefix="field" %>
<%@ taglib uri="/taglib/featureVisibility" prefix="feature" %>
<%@ taglib uri="/taglib/moduleVisibility" prefix="module" %>
<%@ taglib uri="/taglib/jstl-functions" prefix="fn" %>

<script language="JavaScript" type="text/javascript" src="<digi:file src='module/aim/scripts/panel/yahoo-min.js'/>" > .</script>
<script language="JavaScript" type="text/javascript" src="<digi:file src='module/aim/scripts/panel/yahoo-dom-event.js'/>" >.</script>
<script language="JavaScript" type="text/javascript" src="<digi:file src='module/aim/scripts/panel/container-min.js'/>" >.</script>
<script language="JavaScript" type="text/javascript" src="<digi:file src='module/aim/scripts/panel/dragdrop-min.js'/>" >.</script>
<script language="JavaScript" type="text/javascript" src="<digi:file src='module/aim/scripts/panel/event-min.js'/>" >.</script>

<div id="myContent" style="display: none">
	<div id="myContentContent" class="content">
		<input type="text">
	</div>
</div>

<script type="text/javascript">
<!--

		YAHOOAmp.namespace("YAHOOAmp.amp");

		var myPanel = new YAHOOAmp.widget.Panel("saveCustomReports", {
			width:"400px",
			fixedcenter: true,
		    constraintoviewport: false,
		    underlay:"none",
		    close:true,
		    visible:false,
		    modal:true,
		    draggable:true,
		    context: ["showbtn", "tl", "bl"]
		    });
	var panelStart=0;

	function initSaveScript() {
		var msg='\n<digi:trn>Save New Multi-dimensional Report</digi:trn>';
		myPanel.setHeader(msg);
		myPanel.setBody("");
		myPanel.beforeHideEvent.subscribe(function() {
			panelStart=1;
		}); 
		
		myPanel.render(document.body);
	}
	//this is called from editActivityMenu.jsp
	//window.onload=initSaveScript();
	addLoadEvent(initSaveScript);
-->	
</script>
<style type="text/css">
	.mask {
	  -moz-opacity: 0.8;
	  opacity:.80;
	  filter: alpha(opacity=80);
	  background-color:#2f2f2f;
	}
	
	#myStep2 .content { 
	    overflow:auto; 
	    height:455px; 
	    background-color:fff; 
	    padding:10px; 
	} 

	
</style>



<script language="JavaScript">
    <!--
   
    //DO NOT REMOVE THIS FUNCTION --- AGAIN!!!!
    function mapCallBack(status, statusText, responseText, responseXML){
       window.location.reload();
    }
    
    
    var responseSuccess = function(o){
	/* Please see the Success Case section for more
	 * details on the response object's properties.
	 * o.tId
	 * o.status
	 * o.statusText
	 * o.getResponseHeader[ ]
	 * o.getAllResponseHeaders
	 * o.responseText
	 * o.responseXML
	 * o.argument
	 */
		var response = o.responseText; 
		var content = document.getElementById("myContentContent");
	    //response = response.split("<!")[0];
		content.innerHTML = response;
	    //content.style.visibility = "visible";
		
		showContent();
	}
 
	var responseFailure = function(o){ 
	// Access the response object's properties in the 
	// same manner as listed in responseSuccess( ). 
	// Please see the Failure Case section and 
	// Communication Error sub-section for more details on the 
	// response object's properties.
		//alert("Connection Failure!"); 
	}  
	var callback = 
	{ 
		success:responseSuccess, 
		failure:responseFailure 
	};

	function showContent(){
		var element = document.getElementById("myContent");
		element.style.display = "inline";
		if (panelStart < 1){
			myPanel.setBody(element);
		}
		if (panelStart < 2){
			document.getElementById("myContent").scrollTop=0;
			myPanel.show();
			panelStart = 2;
		}
		load();
	}

	function myclose(){
		myPanel.hide();	
		panelStart=1;
	
	}

	function mainSaveReports(){
		showPanelLoading();
		<digi:context name="saveReport" property="context/module/moduleinstance/SaveHtml.do"/>
		var url = "<%=saveReport%>?";
		YAHOOAmp.util.Connect.asyncRequest("GET", url, callback);
	}

	function showPanelLoading(){
		  var content = document.getElementById("myContentContent");
			content.innerHTML = '<div style="text-align: center">' + 
			'<img src="/repository/aim/view/images/images_dhtmlsuite/ajax-loader-darkblue.gif" border="0" height="17px"/>&nbsp;&nbsp;' + 
			'<digi:trn>Loading, please wait ...</digi:trn><br/><br/></div>';
		  showContent();
	}

	-->

</script>
<script language="JavaScript">

function validate() {
	if (isEmpty(document.SaveHtmlForm.reportname.value) == true) {
		alert('<digi:trn>Report Name not entered</digi:trn>');
		document.SaveHtmlForm.reportname.focus();
		return false;
	}
	
	return true;
}

function save() {
	var valid = validate();
	if (valid == true) {
		var postString = "";
		<digi:context name="showreport" property="context/module/moduleinstance/SaveHtml.do" />
		var url = "<%=showreport%>"
		YAHOOAmp.util.Connect.asyncRequest("GET", url, callback);
		myclose();
		reload();
	}
	return valid;
}
function reload() {
	document.SaveHtmlForm.action.value="save";
	document.SaveHtmlForm.submit();	
}

function closePopup() {
	myclose();
}
</script>
